### Writing Tests for the update function

As the equality of the type signatures of the classic and **Transit** approaches update functions already suggest: We can use them interchangeably. That means **Transit** can be seamlessly integrated into existing codebases. Let's verify this.

#### Testing State Transitions

We'll make use of the following functions from the `Data.Array` module of the `arrays` package:

<!-- PD_START:purs
inline: true
pick:
  - tag: signature_or_foreign
    name: foldl
    filePath: .spago/p/arrays-7.3.0/src/Data/Array.purs
    prefix: '- '
  - tag: signature_or_foreign
    name: scanl
    filePath: .spago/p/arrays-7.3.0/src/Data/Array.purs
    prefix: '- '
split: true
-->

- `foldl :: forall a b. (b -> a -> b) -> b -> Array a -> b`
- `scanl :: forall a b. (b -> a -> b) -> b -> Array a -> Array b`

<!-- PD_END -->

Now, how can we test the update function? An easy way is to perform a fold over the messages and check if the final state is the expected one:

<!-- PD_START:purs
filePath: test/Examples/SimpleDoor.purs
pick:
  - tag: value
    name: assert1
-->

```purescript
assert1 =
  (foldl update DoorOpen [ Close, Open, Close ])
    `shouldEqual`
      DoorClosed
```

<p align="right"><sup>ðŸ—Ž <a href="test/Examples/SimpleDoor.purs#L60-L63">test/Examples/SimpleDoor.purs L60-L63</a></sup></p>
<!-- PD_END -->

However, this only checks the final state. We should also check all intermediate states. For this purpose the scanl function is perfectly suited. It works like foldl, but it returns an array of all intermediate states.

<!-- PD_START:purs
filePath: test/Examples/SimpleDoor.purs
pick:
  - tag: value
    name: assert2
-->

```purescript
assert2 =
  (scanl update DoorOpen [ Close, Open, Close ])
    `shouldEqual`
      [ DoorClosed, DoorOpen, DoorClosed ]
```

<p align="right"><sup>ðŸ—Ž <a href="test/Examples/SimpleDoor.purs#L66-L69">test/Examples/SimpleDoor.purs L66-L69</a></sup></p>
<!-- PD_END -->

Since we want to perform many of these tests, we'll define a convenient helper function `assertWalk` that performs the test and asserts the result:

<!-- PD_START:purs
pick:
  - tag: any
    name: assertWalk
    filePath: test/Examples/Common.purs
-->

```purescript
assertWalk
  :: forall msg state
   . Eq state
  => Show state
  => (state -> msg -> state)
  -> state
  -> Array (msg /\ state)
  -> Aff Unit
assertWalk updateFn initState walk = do
  let
    msgs :: Array msg
    msgs = map fst walk

    expectedStates :: Array state
    expectedStates = map snd walk

    actualStates :: Array state
    actualStates = scanl updateFn initState msgs

  actualStates `shouldEqual` expectedStates
```

<!-- PD_END -->

We can use it like this:

<!-- PD_START:purs
pick:
  - tag: value
    name: assert3
    filePath: test/Examples/SimpleDoor.purs
-->

```purescript
assert3 =
  assertWalk update
    DoorOpen
    [ Close /\ DoorClosed
    , Open /\ DoorOpen
    , Close /\ DoorClosed
    ]
```

<!-- PD_END -->

#### Verifying Interchangeability

Of course we want to check this with both the classic and **Transit** approaches. The following test checks all intermediate states for both approaches.

<!-- PD_START:purs
filePath: test/Examples/SimpleDoor.purs
pick:
  - tag: value
    name: assert4
-->

```purescript
assert4 =
  for_ [ updateClassic, update ]
    \fn ->
      assertWalk fn
        DoorOpen
        [ Close /\ DoorClosed
        , Open /\ DoorOpen
        , Open /\ DoorOpen
        , Close /\ DoorClosed
        , Open /\ DoorOpen
        ]
```

<p align="right"><sup>ðŸ—Ž <a href="test/Examples/SimpleDoor.purs#L81-L91">test/Examples/SimpleDoor.purs L81-L91</a></sup></p>
<!-- PD_END -->
