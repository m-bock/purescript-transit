<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Your GitHub stylesheet -->
    <link rel="stylesheet" href="assets/github.css" />

    <!-- Your custom layout -->
    <style>
      html {
        overflow-y: scroll;
      }

      body {
        margin: 0;
        padding: 0;
        background-color: #0d1117;
      }

      .markdown-body {
        box-sizing: border-box;
        min-width: 200px;
        max-width: 980px;
        width: 100%;
        margin: 0 auto;
        padding: 60px 45px 45px;
      }

      /* Optional: nicer TOC spacing */
      nav.toc {
        margin-bottom: 2.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #30363d;
      }

      /* Index page subtitle */
      .page-subtitle {
        font-size: 18px;
        color: #8b949e;
        margin-bottom: 2rem;
      }

      /* Sub-TOC for each page */
      nav.page-toc {
        margin: 2rem 0;
        padding: 1.5rem;
        background-color: #161b22;
        border-radius: 6px;
        border: 1px solid #30363d;
      }

      tr > td:nth-child(2),
      tr > td:nth-child(4),
      tr > td:nth-child(6) {
        text-align: center;
      }

      nav.page-toc ul > li {
        margin-bottom: 1rem;
      }

      #TOC > ul {
        padding-left: 0;
      }

      #TOC > ul > li {
        margin: 1rem;
      }

      #TOC > ul > li > a {
        font-size: 20px;
      }

      #TOC > ul > li > ul > li {
        margin: 0.5rem 0;
      }

      nav.page-toc a {
        color: #8b949e;
        text-decoration: none;
        font-size: 14px;
      }

      nav.page-toc a:hover {
        color: #58a6ff;
      }

      nav.page-toc ul ul {
        padding-left: 1.5rem;
        margin-top: 0.25rem;
      }

      /* Pager navigation */
      nav.pager {
        position: sticky;
        top: 0;
        box-sizing: border-box;
        z-index: 100;
        background-color: #0d1117;
        padding: 1rem 45px 1.5rem;
        border-bottom: 1px solid #30363d;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
      }

      nav.pager .pager-inner {
        max-width: 1400px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 2rem;
      }

      nav.pager .header-title {
        font-size: 18px;
        font-weight: 600;
        color: #c9d1d9;
        text-decoration: none;
        margin-right: auto;
      }

      nav.pager .header-title:hover {
        color: #58a6ff;
      }

      nav.pager .nav-links {
        display: flex;
        gap: 2rem;
        align-items: center;
      }

      nav.pager .github-link {
        color: #8b949e;
        text-decoration: none;
        font-size: 14px;
        transition: color 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      nav.pager .github-link:hover {
        color: #58a6ff;
      }

      nav.pager .github-link img {
        width: 16px;
        height: 16px;
        vertical-align: middle;
      }

      /* Scroll to top link */
      .scroll-to-top {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid #30363d;
        text-align: center;
        display: none;
      }

      .scroll-to-top.visible {
        display: block;
      }

      .scroll-to-top a {
        color: #58a6ff;
        text-decoration: none;
        padding: 0.75rem 1.25rem;
        border-radius: 6px;
        transition: all 0.2s ease;
        font-size: 14px;
        display: inline-block;
      }

      .scroll-to-top a:hover {
        background-color: #161b22;
        color: #79c0ff;
      }

      nav.pager a {
        color: #58a6ff;
        text-decoration: none;
        padding: 0.75rem 1.25rem;
        border-radius: 6px;
        transition: all 0.2s ease;
        font-size: 14px;
        display: inline-block;
      }

      nav.pager a:hover {
        background-color: #161b22;
        color: #79c0ff;
      }

      nav.pager a.disabled,
      nav.pager span.disabled {
        color: #30363d;
        cursor: not-allowed;
        pointer-events: none;
      }

      nav.pager a.disabled:hover,
      nav.pager span.disabled:hover {
        background-color: transparent;
        color: #30363d;
      }

      /* Scroll offset for anchor links to account for sticky header */
      .markdown-body h1,
      .markdown-body h2,
      .markdown-body h3,
      .markdown-body h4,
      .markdown-body h5,
      .markdown-body h6 {
        scroll-margin-top: 200px;
      }

      /* Remove zebra striping from tables and use lighter background */
      .markdown-body table {
        background-color: var(--bgColor-muted);
      }

      .markdown-body table tr {
        background-color: var(--bgColor-muted);
      }

      .markdown-body table tr:nth-child(2n) {
        background-color: var(--bgColor-muted);
      }

      .state-diagram {
        border: 1px solid #30363d;
        border-radius: 6px;
        padding: 1rem;
        background-color: var(--bgColor-muted);
      }

      .footnotes {
        border-top: 0 !important;
      }
    </style>

    <!-- Pandoc syntax highlighting CSS -->
        <style type="text/css">
      html { -webkit-text-size-adjust: 100%; }
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        { color: #cccccc; background-color: #303030; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ffcfaf; } /* Alert */
      code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
      code span.at { } /* Attribute */
      code span.bn { color: #dca3a3; } /* BaseN */
      code span.bu { } /* BuiltIn */
      code span.cf { color: #f0dfaf; } /* ControlFlow */
      code span.ch { color: #dca3a3; } /* Char */
      code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
      code span.co { color: #7f9f7f; } /* Comment */
      code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
      code span.do { color: #7f9f7f; } /* Documentation */
      code span.dt { color: #dfdfbf; } /* DataType */
      code span.dv { color: #dcdccc; } /* DecVal */
      code span.er { color: #c3bf9f; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #c0bed1; } /* Float */
      code span.fu { color: #efef8f; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
      code span.kw { color: #f0dfaf; } /* Keyword */
      code span.op { color: #f0efd0; } /* Operator */
      code span.ot { color: #efef8f; } /* Other */
      code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
      code span.sc { color: #dca3a3; } /* SpecialChar */
      code span.ss { color: #cc9393; } /* SpecialString */
      code span.st { color: #cc9393; } /* String */
      code span.va { } /* Variable */
      code span.vs { color: #cc9393; } /* VerbatimString */
      code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
    </style>
      </head>

  <body>
    <nav class="pager">
      <div class="pager-inner">
        <a
          href="https://github.com/m-bock/purescript-transit"
          class="github-link"
          target="_blank"
          rel="noopener"
          title="View on GitHub"
        >
          <img src="assets/github-mark-white.svg" alt="GitHub" />
          m-bock/purescript-transit
        </a>
        <div class="nav-links">
                    <a href="3.2-the-classic-approach.html" rel="prev" title="The Classic Approach"
            >‚Üê Previous</a
          >
           

          <a href="index.html">‚â° Contents</a>
                     <a href="3.4-conclusion-1.html" rel="next" title="Conclusion"
            >Next ‚Üí</a
          >
                  </div>
      </div>
    </nav>
    <article class="markdown-body">
       <h2 data-number="3.3" id="the-transit-approach">The Transit
Approach</h2>
<p>In the DSL specification, we express conditional transitions by
listing multiple possible target states:</p>
<!-- PD_START:purs
filePath: test/Examples/DoorPin.purs
pick:
  - State
  - Msg
-->
<div class="sourceCode" id="cb1"><pre
class="sourceCode purescript"><code class="sourceCode purescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">State</span> <span class="ot">=</span> <span class="dt">Variant</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  ( <span class="st">&quot;DoorOpen&quot;</span><span class="ot"> ::</span> {}</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;DoorClosed&quot;</span><span class="ot"> ::</span> {}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;DoorLocked&quot;</span><span class="ot"> ::</span> {<span class="ot"> storedPin ::</span> <span class="dt">String</span> }</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Msg</span> <span class="ot">=</span> <span class="dt">Variant</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  ( <span class="st">&quot;Close&quot;</span><span class="ot"> ::</span> {}</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;Open&quot;</span><span class="ot"> ::</span> {}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;Lock&quot;</span><span class="ot"> ::</span> {<span class="ot"> newPin ::</span> <span class="dt">String</span> }</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  , <span class="st">&quot;Unlock&quot;</span><span class="ot"> ::</span> {<span class="ot"> enteredPin ::</span> <span class="dt">String</span> }</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p align="right">
<sup
    >üóé
<a href="https://github.com/m-bock/purescript-transit/blob/main/test/Examples/DoorPin.purs#L29-L40">test/Examples/DoorPin.purs
L29-L40</a> </sup>
</p>
<!-- PD_END -->
<!-- PD_START:purs
filePath: test/Examples/DoorPin.purs
pick:
  - DoorPinTransit
-->
<div class="sourceCode" id="cb2"><pre
class="sourceCode purescript"><code class="sourceCode purescript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">DoorPinTransit</span> <span class="ot">=</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Transit</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">:*</span> (<span class="st">&quot;DoorOpen&quot;</span> <span class="op">:@</span> <span class="st">&quot;Close&quot;</span> <span class="op">&gt;|</span> <span class="st">&quot;DoorClosed&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">:*</span> (<span class="st">&quot;DoorClosed&quot;</span> <span class="op">:@</span> <span class="st">&quot;Open&quot;</span> <span class="op">&gt;|</span> <span class="st">&quot;DoorOpen&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">:*</span> (<span class="st">&quot;DoorClosed&quot;</span> <span class="op">:@</span> <span class="st">&quot;Lock&quot;</span> <span class="op">&gt;|</span> <span class="st">&quot;DoorLocked&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">:*</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      ( <span class="st">&quot;DoorLocked&quot;</span> <span class="op">:@</span> <span class="st">&quot;Unlock&quot;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>          <span class="op">&gt;|</span> (<span class="st">&quot;PinCorrect&quot;</span> <span class="op">:?</span> <span class="st">&quot;DoorClosed&quot;</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>          <span class="op">&gt;|</span> (<span class="st">&quot;PinIncorrect&quot;</span> <span class="op">:?</span> <span class="st">&quot;DoorLocked&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      )</span></code></pre></div>
<p align="right">
<sup
    >üóé
<a href="https://github.com/m-bock/purescript-transit/blob/main/test/Examples/DoorPin.purs#L42-L51">test/Examples/DoorPin.purs
L42-L51</a> </sup>
</p>
<!-- PD_END -->
<p>The syntax
<code>("PinCorrect" :? "DoorClosed") &gt;| ("PinIncorrect" :? "DoorLocked")</code>
indicates that the <code>Unlock</code> message from
<code>DoorLocked</code> can transition to either state, depending on
runtime conditions. The <code>:?</code> operator associates a condition
label (like <code>"PinCorrect"</code>) with a target state, and
<code>&gt;|</code> chains multiple conditional outcomes together.</p>
<p>The update function now has access to both the current state and the
message data, allowing you to implement the conditional logic:</p>
<!-- PD_START:purs
filePath: test/Examples/DoorPin.purs
pick:
  - update
-->
<div class="sourceCode" id="cb3"><pre
class="sourceCode purescript"><code class="sourceCode purescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ot">update ::</span> <span class="dt">State</span> <span class="ot">-&gt;</span> <span class="dt">Msg</span> <span class="ot">-&gt;</span> <span class="dt">State</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>update <span class="ot">=</span> mkUpdate <span class="op">@</span><span class="dt">DoorPinTransit</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  ( match <span class="op">@</span><span class="st">&quot;DoorOpen&quot;</span> <span class="op">@</span><span class="st">&quot;Close&quot;</span> \_ _ <span class="ot">-&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="op">@</span><span class="st">&quot;DoorClosed&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ( match <span class="op">@</span><span class="st">&quot;DoorClosed&quot;</span> <span class="op">@</span><span class="st">&quot;Open&quot;</span> \_ _ <span class="ot">-&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="op">@</span><span class="st">&quot;DoorOpen&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ( match <span class="op">@</span><span class="st">&quot;DoorClosed&quot;</span> <span class="op">@</span><span class="st">&quot;Lock&quot;</span> \_ msg <span class="ot">-&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> <span class="op">@</span><span class="st">&quot;DoorLocked&quot;</span> { storedPin<span class="op">:</span> msg<span class="op">.</span>newPin }</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  ( match <span class="op">@</span><span class="st">&quot;DoorLocked&quot;</span> <span class="op">@</span><span class="st">&quot;Unlock&quot;</span> \state msg <span class="ot">-&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        isCorrect <span class="ot">=</span> state<span class="op">.</span>storedPin <span class="op">==</span> msg<span class="op">.</span>enteredPin</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">in</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> isCorrect <span class="kw">then</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>          returnVia <span class="op">@</span><span class="st">&quot;PinCorrect&quot;</span> <span class="op">@</span><span class="st">&quot;DoorClosed&quot;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>          returnVia <span class="op">@</span><span class="st">&quot;PinIncorrect&quot;</span> <span class="op">@</span><span class="st">&quot;DoorLocked&quot;</span> { storedPin<span class="op">:</span> state<span class="op">.</span>storedPin }</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p align="right">
<sup
    >üóé
<a href="https://github.com/m-bock/purescript-transit/blob/main/test/Examples/DoorPin.purs#L53-L72">test/Examples/DoorPin.purs
L53-L72</a> </sup>
</p>
<!-- PD_END -->
<p>The match handlers receive both the current state and the message,
giving you access to all the data needed to make runtime decisions. The
type system still ensures that only valid target states can be
returned.</p>
<blockquote>
<p><strong>Important</strong>: The order of match handlers in
<code>mkUpdate</code> must match the order of transitions in the DSL
specification.</p>
</blockquote>
<blockquote>
<p><strong>Limitation</strong>: The compiler cannot detect if an
implementation forgets to return a possible case. For example, if a
transition can return either <code>DoorClosed</code> or
<code>DoorLocked</code>, your handler always returns
<code>DoorClosed</code> then the compiler would not detect this error.
Obviously the compiler cannot detect if your handler implements the
conditional logic correctly, so missing a case is just one of many
possible errors.</p>
</blockquote> 
      <div class="scroll-to-top">
        <a
          href="#"
          onclick="
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return false;
          "
          >‚Üë Back to top</a
        >
      </div>
    </article>
    <script>
      (function () {
        function checkScrollable() {
          const scrollToTop = document.querySelector(".scroll-to-top");
          if (!scrollToTop) return;

          const isScrollable =
            document.documentElement.scrollHeight > window.innerHeight;
          if (isScrollable) {
            scrollToTop.classList.add("visible");
          } else {
            scrollToTop.classList.remove("visible");
          }
        }

        // Check on load
        checkScrollable();

        // Check on resize (in case window size changes)
        window.addEventListener("resize", checkScrollable);
      })();
    </script>
  </body>
</html>
